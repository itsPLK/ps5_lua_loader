--[[
    Copyright (C) 2025 anonymous

    This file 'kernel_patches_ps4.lua' contains a derivative work
    of the PS4 kernel patches shellcodes, which originally are a part of PSFree.

    Based on the kernel patches of: TheFlow, ChendoChap, abc, AlAzif and LightningMods.
    Source: https://github.com/shahrilnet/remote_lua_loader/blob/main/payloads/psfree-1.5rc1.7z
    Modified Source: https://github.com/shahrilnet/remote_lua_loader/blob/main/payloads/ps4-kpatches-src.7z

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.
]]

local shellcode_900 = "b9820000c00f3248c1e22089c04809c2488d8a40feffff0f20c04825fffffeff0f22c0b89090ffffbe9090ffffbf9090ffff41b89090ffff668981f7162700b89090ffff41b99090ffff41ba9090ffff66898174686200b89090ffff41bb9090ffff4881c2edc50400668981b9040000b89090ffff668981b5040000b89090ffff6689818b0b0800b890e9ffff6689b103172700c68105172700906689b902162700664489810e162700c681101627009066448989a31b270066448991af1b2700c681b11b27009066448999e01b2700c681cd0a0000ebc681fd132700ebc68141142700ebc681bd142700ebc68101152700ebc681ad162700ebc6815d1b2700ebc6812d1c2700ebc7819004000000000000c681c2040000ebc681061a0000ebc7818d0b080090909090668981c4ae2300c6817fb62300ebc781401b22004831c0c3c6812a63160037c6812d63160037c781200510010200000048899128051001c7814c051001010000000f20c0480d000001000f22c031c0c3" -- Tested

local shellcode_903 = "b9820000c00f3248c1e22089c04809c2488d8a40feffff0f20c04825fffffeff0f22c0b89090ffffbe9090ffffbf9090ffff41b89090ffff66898177132700b89090ffff41b99090ffff41ba9090ffff66898134486200b89090ffff41bb9090ffff4881c29b300500668981b9040000b89090ffff668981b5040000b89090ffff6689818b0b0800b890e9ffff6689b183132700c68185132700906689b982122700664489818e122700c68190122700906644898923182700664489912f182700c68131182700906644899960182700c681cd0a0000ebc6817d102700ebc681c1102700ebc6813d112700ebc68181112700ebc6812d132700ebc681dd172700ebc681ad182700ebc7819004000000000000c681c2040000ebc681061a0000ebc7818d0b08009090909066898194ab2300c6814fb32300ebc781101822004831c0c3c681da62160037c681dd62160037c78120c50f010200000048899128c50f01c7814cc50f01010000000f20c0480d000001000f22c031c0c3"

local shellcode_950 = "b9820000c00f3248c1e22089c04809c2488d8a40feffff0f20c04825fffffeff0f22c0b89090ffffbe9090ffffbf9090ffff41b89090ffff668981071f2000b89090ffff41b99090ffff41ba9090ffff668981e44a6200b89090ffff41bb9090ffff4881c2ad580100668981b9040000b89090ffff668981b5040000b89090ffff6689813b6d1900b890e9ffff6689b1131f2000c681151f2000906689b9121e2000664489811e1e2000c681201e20009066448989b323200066448991bf232000c681c12320009066448999f0232000c681cd0a0000ebc6810d1c2000ebc681511c2000ebc681cd1c2000ebc681111d2000ebc681bd1e2000ebc6816d232000ebc6813d242000ebc7819004000000000000c681c2040000ebc68136a51f00ebc7813d6d19009090909066898124f71900c681dffe1900ebc781601901004831c0c3c6817a2d120037c6817d2d120037c78100950f010200000048899108950f01c7812c950f01010000000f20c0480d000001000f22c031c0c3" -- Tested

local shellcode_1000 = "b9820000c00f3248c1e22089c04809c2488d8a40feffff0f20c04825fffffeff0f22c0b89090ffffbe9090ffffbf9090ffff41b89090ffff668981672f4700b89090ffff41b99090ffff41ba9090ffff66898164e86100b89090ffff41bb9090ffff4881c2f1660000668981b9040000b89090ffff668981b5040000b89090ffff6689817b203900b890e9ffff6689b1732f4700c681752f4700906689b9722e4700664489817e2e4700c681802e4700906644898913344700664489911f344700c68121344700906644899950344700c681cd0a0000ebc6816d2c4700ebc681b12c4700ebc6812d2d4700ebc681712d4700ebc6811d2f4700ebc681cd334700ebc6819d344700ebc7819004000000000000c681c2040000ebc68156772600ebc7817d20390090909090668981a4fa1800c6815f021900ebc78140ea1b004831c0c3c6819ad50e0037c6819dd50e0037c781a02f100102000000488991a82f1001c781cc2f1001010000000f20c0480d000001000f22c031c0c3"

local shellcode_1050 = "b9820000c00f3248c1e22089c04809c2488d8a40feffff0f20c04825fffffeff0f22c0b89090ffffbe9090ffffbf9090ffff41b89090ffff668981b7750d00b89090ffff41b99090ffff41ba9090ffff668981b47d6200b89090ffff41bb9090ffff4881c22d0c0500668981b9040000b89090ffff668981b5040000b89090ffff668981ecb24700b890e9ffff6689b1c3750d00c681c5750d00906689b9c2740d0066448981ce740d00c681d0740d009066448989637a0d00664489916f7a0d00c681717a0d009066448999a07a0d00c681cd0a0000ebc681bd720d00ebc68101730d00ebc6817d730d00ebc681c1730d00ebc6816d750d00ebc6811d7a0d00ebc681ed7a0d00ebc7819004000000000000c681c2040000ebc681c6c10800ebc781eeb2470090909090668981d42a2100c68188302100ebc78160ab2d004831c0c3c6812ac4190037c6812dc4190037c781d02b100102000000488991d82b1001c781fc2b1001010000000f20c0480d000001000f22c031c0c3"

local shellcode_1100 = "b9820000c00f3248c1e22089c04809c2488d8a40feffff0f20c04825fffffeff0f22c0b89090ffffbe9090ffffbf9090ffff41b89090ffff66898137e02d00b89090ffff41b99090ffff41ba9090ffff668981334c1e00b89090ffff41bb9090ffff4881c261180700668981434c1e00b890e9ffff668981634c1e00b89090ffff6689b143e02d00be9090ffff6689b942df2d00bf9090ffff664489814edf2d0041b890e9ffff668981643f6200b89090ffffc68145e02d0090c68150df2d009066448989e3e42d0066448991efe42d00c681f1e42d00906644899920e52d00c781354c1e0090909090c781454c1e0090909090c681cd0a0000ebc6813ddd2d00ebc68181dd2d00ebc681fddd2d00ebc68141de2d00ebc681eddf2d00ebc6819de42d00ebc6816de52d00ebc7819004000000000000c681c2040000eb668981b90400006689b1b5040000c68126154300eb6689b9ecc83500c781eec835009090909066448981f4461e00c681a84c1e00ebc781e08c08004831c0c3c6816a62150037c6816d62150037c781701910010200000048899178191001c7819c191001010000000f20c0480d000001000f22c031c0c3" -- Tested

local shellcode_1102 = "b9820000c00f3248c1e22089c04809c2488d8a40feffff0f20c04825fffffeff0f22c0b89090ffffbe9090ffffbf9090ffff41b89090ffff66898157e02d00b89090ffff41b99090ffff41ba9090ffff668981534c1e00b89090ffff41bb9090ffff4881c261180700668981634c1e00b890e9ffff668981834c1e00b89090ffff6689b163e02d00be9090ffff6689b962df2d00bf9090ffff664489816edf2d0041b890e9ffff668981043f6200b89090ffffc68165e02d0090c68170df2d00906644898903e52d00664489910fe52d00c68111e52d00906644899940e52d00c781554c1e0090909090c781654c1e0090909090c681cd0a0000ebc6815ddd2d00ebc681a1dd2d00ebc6811dde2d00ebc68161de2d00ebc6810dd02d00ebc681bde42d00ebc6818de52d00ebc7819004000000000000c681c2040000eb668981b90400006689b1b5040000c681b6144300eb6689b90cc93500c7810ec93500909090906644898114471e00c681c84c1e00ebc781e08c08004831c0c3c6818a62150037c6818d62150037c781701910010200000048899178191001c7819c191001010000000f20c0480d000001000f22c031c0c3" -- Tested

local shellcode_1150 = "b9820000c00f3248c1e22089c04809c2488d8a40feffff0f20c04825fffffeff0f22c0b89090ffffbe9090ffffbf9090ffff41b89090ffff668981e7d52b00b89090ffff41b99090ffff41ba9090ffff668981a3761b00b89090ffff41bb9090ffff4881c215030700668981b3761b00b890e9ffff668981d3761b00b89090ffff6689b1f3d52b00be9090ffff6689b9f2d42b00bf9090ffff66448981fed42b0041b890e9ffff668981b4786200b89090ffffc681f5d52b0090c68100d52b00906644898993da2b00664489919fda2b00c681a1da2b009066448999d0da2b00c781a5761b0090909090c781b5761b0090909090c681cd0a0000ebc681edd22b00ebc68131d32b00ebc681add32b00ebc681f1d32b00ebc6819dd52b00ebc6814dda2b00ebc6811ddb2b00ebc7819004000000000000c681c2040000eb668981b90400006689b1b5040000c681a6123900eb6689b9acbe2f00c781aebe2f00909090906644898164711b00c68118771b00ebc78120d63b004831c0c3c6813aa61f0037c6813da61f0037c781802d100102000000488991882d1001c781ac2d1001010000000f20c0480d000001000f22c031c0c3"

local shellcode_1200 = "b9820000c00f3248c1e22089c04809c2488d8a40feffff0f20c04825fffffeff0f22c0b89090ffffbe9090ffffbf9090ffff41b89090ffff668981c7d62b00b89090ffff41b99090ffff41ba9090ffff668981a3761b00b89090ffff41bb9090ffff4881c271790400668981b3761b00b890e9ffff668981d3761b00b89090ffff6689b1d3d62b00be9090ffff6689b9d2d52b00bf9090ffff66448981ded52b0041b890e9ffff668981f47a6200b89090ffffc681d5d62b0090c681e0d52b00906644898973db2b00664489917fdb2b00c68181db2b009066448999b0db2b00c781a5761b0090909090c781b5761b0090909090c681cd0a0000ebc681cdd32b00ebc68111d42b00ebc6818dd42b00ebc681d1d42b00ebc6817dd62b00ebc6812ddb2b00ebc681fddb2b00ebc7819004000000000000c681c2040000eb668981b90400006689b1b5040000c681e6143900eb6689b9ecc02f00c781eec02f00909090906644898164711b00c68118771b00ebc78160d83b004831c0c3c6811aa71f0037c6811da71f0037c781802d100102000000488991882d1001c781ac2d1001010000000f20c0480d000001000f22c031c0c3"

function get_kernel_patches_shellcode()
    local shellcode = ""
    if FW_VERSION == "9.00" then
        shellcode = shellcode_900
    elseif FW_VERSION == "9.03" or FW_VERSION == "9.04" then
        shellcode = shellcode_903
    elseif FW_VERSION == "9.50" or FW_VERSION == "9.51" or FW_VERSION == "9.60" then
        shellcode = shellcode_950
    elseif FW_VERSION == "10.00" or FW_VERSION == "10.01" then
        shellcode = shellcode_1000
    elseif FW_VERSION == "10.50" or FW_VERSION == "10.70" or FW_VERSION == "10.71" then
        shellcode = shellcode_1050
    elseif FW_VERSION == "11.00" then
        shellcode = shellcode_1100
    elseif FW_VERSION == "11.02" then
        shellcode = shellcode_1102
    elseif FW_VERSION == "11.50" or FW_VERSION == "11.52" then
        shellcode = shellcode_1150
    elseif FW_VERSION == "12.00" or FW_VERSION == "12.02" then
        shellcode = shellcode_1200
    end
    if #shellcode == 0 then
        return ""
    end
    
    local bin_data = hex_to_binary(shellcode)
    return bin_data
end
